<?xml version="1.0" encoding="UTF-8"?>
<story-context id="bmad/bmm/story-context/1-1" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Инициализировать модульный монолит и структуру репозитория</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-10</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-1-initializirovat-modulnyj-monolit-i-strukturu-repozitoriya.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>DevOps-инженер</asA>
    <iWant>создать репозиторий со структурой Spring Modulith</iWant>
    <soThat>команда могла быстро приступить к реализации бизнес-функций</soThat>
    <tasks>
      <task id="1" ac="1.1.1,1.1.3">
        <title>Инициализировать Git репозиторий и базовую структуру</title>
        <subtasks>
          <subtask>Инициализировать Git репозиторий: git init</subtask>
          <subtask>CREATE .gitignore - Gradle, IDE files, OS-specific</subtask>
          <subtask>CREATE docs/.gitkeep - Placeholder для architecture/design документов</subtask>
          <subtask>CREATE scripts/.gitkeep - Placeholder для utility scripts</subtask>
          <subtask>CREATE README.md - Project overview, setup instructions, module structure</subtask>
          <subtask>CREATE CONTRIBUTING.md - Development guidelines, coding standards</subtask>
        </subtasks>
      </task>
      <task id="2" ac="1.1.2">
        <title>Настроить Gradle build и dependency management</title>
        <subtasks>
          <subtask>CREATE build.gradle - Spring Boot 4.0.0-RC2 plugin, java toolchain (Java 21)</subtask>
          <subtask>CREATE settings.gradle - rootProject.name = 'tech-support'</subtask>
          <subtask>CREATE gradle.properties - Профили (local/staging/prod)</subtask>
          <subtask>CREATE gradle/libs.versions.toml - Version catalog</subtask>
          <subtask>Настроить плагины: spotless, jacoco, flyway</subtask>
        </subtasks>
      </task>
      <task id="3" ac="1.1.1">
        <title>Создать модульную структуру Spring Modulith</title>
        <subtasks>
          <subtask>CREATE src/main/java/com/techsupport/TechSupportApplication.java</subtask>
          <subtask>CREATE src/main/java/com/techsupport/usermanagement/package-info.java</subtask>
          <subtask>CREATE src/main/java/com/techsupport/usermanagement/api/.gitkeep</subtask>
          <subtask>CREATE src/main/java/com/techsupport/usermanagement/impl/.gitkeep</subtask>
          <subtask>CREATE package-info.java для ticketing, audit, analytics, notification, knowledgebase</subtask>
          <subtask>CREATE api/.gitkeep и impl/.gitkeep для всех модулей</subtask>
        </subtasks>
      </task>
      <task id="4" ac="1.1.2">
        <title>Настроить core dependencies в build.gradle</title>
        <subtasks>
          <subtask>Spring Boot starters: web, data-jpa, security, validation, actuator</subtask>
          <subtask>Spring Modulith: core, jpa, events-jdbc</subtask>
          <subtask>Database: PostgreSQL driver 42.7.4, Flyway 11.1.0</subtask>
          <subtask>Testing: spring-boot-starter-test, spring-modulith-starter-test, testcontainers-bom 1.20.4</subtask>
          <subtask>Observability: micrometer-registry-prometheus, logstash-logback-encoder</subtask>
        </subtasks>
      </task>
      <task id="5" ac="1.1.2">
        <title>Создать базовые конфигурационные файлы</title>
        <subtasks>
          <subtask>CREATE src/main/resources/application.yml</subtask>
          <subtask>CREATE src/main/resources/application-local.yml</subtask>
          <subtask>CREATE src/main/resources/application-staging.yml</subtask>
          <subtask>CREATE src/main/resources/application-prod.yml</subtask>
          <subtask>CREATE src/main/resources/db/migration/.gitkeep</subtask>
        </subtasks>
      </task>
      <task id="6" ac="1.1.3">
        <title>Добавить Modulith Boundary Tests</title>
        <subtasks>
          <subtask>CREATE src/test/java/com/techsupport/ModulithBoundaryTest.java</subtask>
          <subtask>Настроить ArchUnit rules для проверки module isolation</subtask>
          <subtask>Добавить тесты на отсутствие циклических зависимостей</subtask>
        </subtasks>
      </task>
      <task id="7" ac="1.1.4">
        <title>Валидация и верификация сборки</title>
        <subtasks>
          <subtask>Запустить gradle clean compileJava - проверить компиляцию</subtask>
          <subtask>Запустить gradle test - проверить unit tests</subtask>
          <subtask>Запустить gradle build - проверить full build cycle</subtask>
          <subtask>Проверить активацию профилей через environment variables</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC-1.1.1">
      <description>В репозитории создан монолит на Spring Boot 4.0.0-RC2 + Spring Modulith 2.0 RC2 с модулями usermanagement, ticketing, audit, analytics, notification, knowledgebase и разделением API/impl.</description>
    </criterion>
    <criterion id="AC-1.1.2">
      <description>Настроены Gradle-зависимости (Gradle 8.11.1), root BOM, профили local, staging, prod, плагины Flyway, Testcontainers, Spotless и JaCoCo.</description>
    </criterion>
    <criterion id="AC-1.1.3">
      <description>Включены базовые тесты Modulith Boundary Test и шаблоны README.md и CONTRIBUTING.md.</description>
    </criterion>
    <criterion id="AC-1.1.4">
      <description>Результаты сборки успешно проходят локальный gradle build.</description>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation &amp; Infrastructure Enablement</title>
        <section>Services and Modules</section>
        <snippet>6 модулей с API/impl разделением: usermanagement, ticketing, audit, analytics, notification, knowledgebase. Inter-module communication через Spring Modulith Events.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification</title>
        <section>Core Dependencies</section>
        <snippet>Spring Boot 4.0.0-RC2, Spring Modulith 2.0 RC2, PostgreSQL 42.7.4, Flyway 11.1.0, Testcontainers BOM 1.20.4, JaCoCo, Spotless.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification</title>
        <section>Acceptance Criteria</section>
        <snippet>AC-1.1.1 through AC-1.1.4: модульная структура, Gradle конфигурация, boundary tests, успешная сборка.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-story-1-1.md</path>
        <title>Tech Spec: Story 1.1</title>
        <section>Development Context</section>
        <snippet>Explicit CREATE actions для всех файлов. Code examples: package-info.java, TechSupportApplication.java, build.gradle starter.</snippet>
      </doc>
      <doc>
        <path>docs/architecture-2025-11-06.md</path>
        <title>Tech-Support Decision Architecture Document</title>
        <section>ADR-001: Modular Monolith</section>
        <snippet>Spring Modulith 2.0 RC2 с event-driven design. Module boundaries через @ApplicationModule. 6 bounded contexts с чёткими API границами.</snippet>
      </doc>
      <doc>
        <path>docs/architecture-2025-11-06.md</path>
        <title>Architecture Document</title>
        <section>Project Initialization</section>
        <snippet>Backend: Gradle project, Java 21, Spring Boot 4.0.0-RC2. Provided by starter: web, data-jpa, security, validation, actuator, PostgreSQL.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Tech-Support Epic Breakdown</title>
        <section>Epic 1: Foundation &amp; Infrastructure</section>
        <snippet>Story 1.1: Repository initialization с модульной структурой Spring Modulith, CI/CD подготовка, базовые тесты.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Technology Stack</section>
        <snippet>Backend: Spring Boot 4.0, Spring Modulith 2.0, PostgreSQL 17. Deployment: On-premise, modular monolith architecture.</snippet>
      </doc>
      <doc>
        <path>docs/devops-strategy-2025-11-06.md</path>
        <title>DevOps Strategy</title>
        <section>Build System</section>
        <snippet>Gradle 8.11.1 с version catalog, Java 21 toolchain. CI/CD: GitHub Actions, Docker containerization.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>N/A - Greenfield project</path>
        <kind>none</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Это новый проект без существующей кодовой базы. Все файлы будут созданы с нуля согласно спецификации.</reason>
      </artifact>
    </code>
    <dependencies>
      <gradle>
        <dependency>
          <name>Spring Boot</name>
          <version>4.0.0-RC2</version>
          <scope>implementation</scope>
        </dependency>
        <dependency>
          <name>Spring Modulith</name>
          <version>2.0.0-RC2</version>
          <scope>implementation</scope>
        </dependency>
        <dependency>
          <name>PostgreSQL JDBC Driver</name>
          <version>42.7.4</version>
          <scope>runtime</scope>
        </dependency>
        <dependency>
          <name>Flyway Core</name>
          <version>11.1.0</version>
          <scope>implementation</scope>
        </dependency>
        <dependency>
          <name>Testcontainers BOM</name>
          <version>1.20.4</version>
          <scope>test</scope>
        </dependency>
        <dependency>
          <name>JaCoCo</name>
          <version>0.8.12</version>
          <scope>build-plugin</scope>
        </dependency>
        <dependency>
          <name>Spotless</name>
          <version>7.0.0.BETA4</version>
          <scope>build-plugin</scope>
        </dependency>
      </gradle>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <title>Spring Modulith Principles</title>
      <description>Module boundaries enforced at runtime via @ApplicationModule. Inter-module communication ONLY through published interfaces (api packages). Implementation details (impl packages) are module-private.</description>
    </constraint>
    <constraint>
      <title>Gradle Structure</title>
      <description>Single-module Gradle project (NOT multi-project Gradle). Package-based modularity via Spring Modulith. Shared build.gradle with centralized dependency versions (libs.versions.toml).</description>
    </constraint>
    <constraint>
      <title>Testing Standards</title>
      <description>Modulith Boundary Tests verify architectural rules. Integration tests use Testcontainers for PostgreSQL. 80%+ code coverage target enforced via JaCoCo.</description>
    </constraint>
    <constraint>
      <title>Code Quality</title>
      <description>Spotless plugin для code formatting. Pre-commit hooks для валидации. No hardcoded credentials (проверяется CI/CD).</description>
    </constraint>
    <constraint>
      <title>Configuration Management</title>
      <description>Профили: local (localhost dev), staging (external services), prod (production config). Переменные окружения для secrets. application*.yml для Spring конфигурации.</description>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>@ApplicationModule annotation</name>
      <kind>Spring Modulith Module Boundary</kind>
      <signature>@org.springframework.modulith.ApplicationModule(displayName = "Module Name")</signature>
      <path>src/main/java/com/techsupport/{module}/package-info.java</path>
    </interface>
    <interface>
      <name>Spring Boot Main Application</name>
      <kind>Application Entry Point</kind>
      <signature>@SpringBootApplication public class TechSupportApplication { public static void main(String[] args) }</signature>
      <path>src/main/java/com/techsupport/TechSupportApplication.java</path>
    </interface>
    <interface>
      <name>Gradle Build Configuration</name>
      <kind>Build System</kind>
      <signature>plugins { id 'java'; id 'org.springframework.boot' version '4.0.0-RC2' }</signature>
      <path>build.gradle</path>
    </interface>
    <interface>
      <name>Version Catalog</name>
      <kind>Dependency Management</kind>
      <signature>[versions] springBoot = "4.0.0-RC2" springModulith = "2.0.0-RC2"</signature>
      <path>gradle/libs.versions.toml</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      <standard>JUnit 5 для unit tests. Spring Boot Test для integration tests. Testcontainers PostgreSQL для database tests. Spring Modulith Test для module boundary verification. ArchUnit для architectural rules enforcement. Test pyramid: 70% unit, 25% integration, 5% E2E.</standard>
    </standards>
    <locations>
      <location>src/test/java/com/techsupport/</location>
      <location>src/test/resources/</location>
    </locations>
    <ideas>
      <idea ac="AC-1.1.1">
        <description>ModulithBoundaryTest: verify module structure, check @ApplicationModule presence for all 6 modules, validate API/impl separation</description>
      </idea>
      <idea ac="AC-1.1.2">
        <description>Gradle configuration test: verify dependencies are resolvable, check profile activation (local/staging/prod), validate plugin presence (spotless, jacoco, flyway)</description>
      </idea>
      <idea ac="AC-1.1.3">
        <description>Template validation: check README.md and CONTRIBUTING.md exist, validate markdown structure, verify required sections present</description>
      </idea>
      <idea ac="AC-1.1.4">
        <description>Build verification: gradle clean compileJava succeeds, gradle test passes with no failures, gradle build completes successfully, measure build time (&lt;3 minutes target)</description>
      </idea>
      <idea ac="AC-1.1.1">
        <description>ArchUnit test: enforce no cyclic dependencies between modules, verify impl packages are not accessed from other modules, check that only api packages are public</description>
      </idea>
    </ideas>
  </tests>
</story-context>
