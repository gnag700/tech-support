# PRD Refinements Summary (2025-11-05)

## Changes Applied for Architecture Phase Readiness

### 1. âœ… Response Time Metrics Consistency
**Section:** Non-Functional Requirements > Performance

**Changes:**
- Added explicit **p50/p95/p99 percentiles** matching NFR template
- **p50:** <200ms for API endpoints, <100ms for CRUD
- **p95:** <300ms for API endpoints, <1s for complex searches
- **p99:** <500ms for API endpoints
- Added database query performance: <100ms p95 for indexed queries

**Impact:** Clear SLA targets for performance testing and monitoring setup.

---

### 2. âœ… API Pagination & Search Specification
**Section:** Appendix C: API Pagination & Search Specification (NEW)

**Changes:**
- **Pagination:** Explicit default (20/page), max (100/page), 1-based page numbering
- **Search fields:** Enumerated searchable fields per endpoint
  - Tickets: 	itle (weighted 2x), description (weighted 1x)
  - Users: ull_name, mail, department
- **Performance:** <500ms p95 for searches on 50K tickets
- **Error responses:** 400 Bad Request examples for invalid pagination/search

**Impact:** Unambiguous frontend contract, no re-checking during implementation.

---

### 3. âœ… Attachment Storage Plan
**Section:** Product Scope > Growth Features > Enhanced Ticketing

**Changes:**
- **MVP/Phase 1:** Filesystem storage at /var/lib/tech-support/attachments/ (ext4, 1TB)
- **Phase 2 Trigger:** Migrate to MinIO when storage >50GB or multi-server deployment
- **Archive Strategy:** Files >2 years moved to cold storage (S3-compatible MinIO archive tier)
- **Monitoring:** Weekly storage checks, alert at 80% capacity (800GB)

**Impact:** Infrastructure team can size storage early, clear migration path documented.

---

### 4. âœ… Dependency Validation (Spring Boot 4.0 RC1)
**Section:** Technical Constraints > Verified Dependency Versions (NEW)

**Added Verified Versions:**
- SpringDoc OpenAPI: 2.7.0
- Testcontainers: 1.20.4 (PostgreSQL 17 support)
- Micrometer Core: 1.14.2
- HikariCP: 6.2.1
- Flyway Core: 11.1.0 (Spring Modulith 2.0 integration)
- Spring Security: 6.4.2
- Jackson Databind: 2.18.2
- Logback Classic: 1.5.12
- PostgreSQL JDBC Driver: 42.7.4 (SCRAM-SHA-256 auth)

**Impact:** No re-validation needed during pom.xml creation, dependency conflicts prevented early.

---

### 5. âœ… Incident Response with Notification Chain
**Section:** Non-Functional Requirements > Security > Incident Response

**Changes:**
- **Detection:** Real-time alerts (Prometheus â†’ Telegram), manual reporting (hotline email)
- **Notification Chain:**
  - **L1 (IT Admin):** <15 min acknowledgment (business hours), <1h after-hours
  - **L2 (Developer - Nag):** <4h acknowledgment, <24h containment
  - **L3 (Ð¦Ð Ð‘ IT Head):** Escalation for data breach, regulatory impact, >4h downtime
- **Timeline by Severity:**
  - **Critical (P1):** <1h ack, <4h containment, <24h RCA, <72h post-mortem
  - **High (P2):** <4h ack, <24h containment, <5 days RCA
  - **Medium (P3):** <8h ack, <3 days investigation
- **Escalation to Ð¦Ð Ð‘ Management:**
  - Immediate (<1h): Data breach, PII exposure, ransomware
  - Within 4h: Prolonged downtime (>4h), suspected external attack
  - Within 24h: Security policy violation, compliance incident

**Impact:** Compliance-ready incident response, clear roles and timelines.

---

### 6. âœ… Log Retention & Sanitization Rules
**Section:** Non-Functional Requirements > Operational > Logging

**Changes:**
- **Log Format:** Structured JSON with explicit fields (timestamp, level, user_id, action, correlation_id)
- **Retention:**
  - **Hot logs:** 90 days in /var/log/tech-support/ (daily rotation, gzip compressed)
  - **Cold archive:** 1 year in /var/log/tech-support/archive/ (monthly tarballs)
  - **Rotation:** Daily at 00:00 via logrotate, max 100MB per file before force-rotation
- **PII Sanitization (Applied at Log Write Time):**
  - **Passwords:** Never logged (excluded from all statements)
  - **Emails:** Masked as <email-hash-{SHA256[:6]}> (regex: \b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b)
  - **Phone numbers:** Masked as <phone-hash-{SHA256[:6]}> (Belarusian +375XXXXXXXXX)
  - **Passport numbers:** Fully redacted as <passport-***>
  - **Auth tokens:** Masked as <token-redacted> (Bearer tokens, session IDs in URLs)
- **Verification:**
  - Weekly automated scan: grep -E "(password|token|@)" /var/log/tech-support/*.log (should return 0)
  - Monthly audit: Security review of random 1000 log lines for compliance

**Impact:** GDPR-compliant logging, concrete scrubbing rules for DevOps implementation.

---

## Summary

**PRD Status:** âœ… **Implementation-Ready for Architecture Phase**

**Key Improvements:**
- Performance SLAs aligned with NFR template (p50/p95/p99)
- Frontend API contract unambiguous (pagination, search fields, error responses)
- Infrastructure sizing enabled (attachment storage plan with migration path)
- Dependency versions verified (no re-checking during pom.xml creation)
- Incident response compliance-ready (notification chain, timelines, escalation)
- Log sanitization rules concrete (regex patterns, rotation schedule, verification)

**Next Workflow:** *create-architecture - Architecture document can now cleanly reference PRD metrics and constraints.

---

**Prepared by:** Business Analyst Mary  
**Date:** 2025-11-05  
**PRD Version:** 1.1 (Refinements Applied)
